#pragma once
#include <Arduino_GFX_Library.h>

/*
 * Init-Sequence für ST7701S Panel HSD4.0IPS (HSD040BPN1-A00) 480x480
 * Quelle: Hersteller-Dokument
 *
 * Wichtige Punkte:
 * - vbp = 15, vfp = 12 (Porch)
 * - Pixelformat: 16-bit RGB565 -> 0x3A = 0x55  (55/50 = 16bit)
 *   (Im Original-Kommentar: 0x66 = RGB666, 0x77 = RGB888)
 */

static const uint8_t st7701_hsd040bpn1_init_operations[] PROGMEM = {
    // ------------------------------------------------------------------------
    // Seite 0x13: Grundkonfiguration
    // ------------------------------------------------------------------------
    BEGIN_WRITE,
    WRITE_COMMAND_8,
    0xFF,
    WRITE_BYTES,
    5,
    0x77,
    0x01,
    0x00,
    0x00,
    0x13,

    WRITE_COMMAND_8,
    0xEF,
    WRITE_BYTES,
    1,
    0x08,

    // ------------------------------------------------------------------------
    // Seite 0x10: Power / Drive Settings + Gamma
    // ------------------------------------------------------------------------
    WRITE_COMMAND_8,
    0xFF,
    WRITE_BYTES,
    5,
    0x77,
    0x01,
    0x00,
    0x00,
    0x10,

    WRITE_COMMAND_8,
    0xC0,
    WRITE_BYTES,
    2,
    0x3B,
    0x00,

    WRITE_COMMAND_8,
    0xC1,
    WRITE_BYTES,
    2,
    0x0D,
    0x02,

    WRITE_COMMAND_8,
    0xC2,
    WRITE_BYTES,
    2,
    0x21,
    0x08,

    WRITE_COMMAND_8,
    0xCD,
    WRITE_BYTES,
    1,
    0x00, // 18-bit Mode in den internen Pfaden, Interface folgt weiter unten

    // Gamma-Positiv (B0)
    WRITE_COMMAND_8,
    0xB0,
    WRITE_BYTES,
    16,
    0x00,
    0x11,
    0x18,
    0x0E,
    0x11,
    0x06,
    0x07,
    0x08,
    0x07,
    0x22,
    0x04,
    0x12,
    0x0F,
    0xAA,
    0x31,
    0x18,

    // Gamma-Negativ (B1)
    WRITE_COMMAND_8,
    0xB1,
    WRITE_BYTES,
    16,
    0x00,
    0x11,
    0x19,
    0x0E,
    0x12,
    0x07,
    0x08,
    0x08,
    0x08,
    0x22,
    0x04,
    0x11,
    0x11,
    0xA9,
    0x32,
    0x18,

    // ------------------------------------------------------------------------
    // Seite 0x11: weitere Drive-/TCON-Settings
    // ------------------------------------------------------------------------
    WRITE_COMMAND_8,
    0xFF,
    WRITE_BYTES,
    5,
    0x77,
    0x01,
    0x00,
    0x00,
    0x11,

    WRITE_COMMAND_8,
    0xB0,
    WRITE_BYTES,
    1,
    0x60,

    WRITE_COMMAND_8,
    0xB1,
    WRITE_BYTES,
    1,
    0x30,

    WRITE_COMMAND_8,
    0xB2,
    WRITE_BYTES,
    1,
    0x87,

    WRITE_COMMAND_8,
    0xB3,
    WRITE_BYTES,
    1,
    0x80,

    WRITE_COMMAND_8,
    0xB5,
    WRITE_BYTES,
    1,
    0x49,

    WRITE_COMMAND_8,
    0xB7,
    WRITE_BYTES,
    1,
    0x85,

    WRITE_COMMAND_8,
    0xB8,
    WRITE_BYTES,
    1,
    0x21,

    WRITE_COMMAND_8,
    0xC1,
    WRITE_BYTES,
    1,
    0x78,

    WRITE_COMMAND_8,
    0xC2,
    WRITE_BYTES,
    1,
    0x78,

    END_WRITE,
    DELAY,
    20,

    // ------------------------------------------------------------------------
    // TCON / Source / Gate Timing (E0..ED)
    // ------------------------------------------------------------------------
    BEGIN_WRITE,

    WRITE_COMMAND_8,
    0xE0,
    WRITE_BYTES,
    3,
    0x00,
    0x1B,
    0x02,

    WRITE_COMMAND_8,
    0xE1,
    WRITE_BYTES,
    11,
    0x08,
    0xA0,
    0x00,
    0x00,
    0x07,
    0xA0,
    0x00,
    0x00,
    0x00,
    0x44,
    0x44,

    WRITE_COMMAND_8,
    0xE2,
    WRITE_BYTES,
    11,
    0x11,
    0x11,
    0x44,
    0x44,
    0xED,
    0xA0,
    0x00,
    0x00,
    0xEC,
    0xA0,
    0x00,
    0x00,

    WRITE_COMMAND_8,
    0xE3,
    WRITE_BYTES,
    4,
    0x00,
    0x00,
    0x11,
    0x11,

    WRITE_COMMAND_8,
    0xE4,
    WRITE_BYTES,
    2,
    0x44,
    0x44,

    WRITE_COMMAND_8,
    0xE5,
    WRITE_BYTES,
    16,
    0x0A,
    0xE9,
    0xD8,
    0xA0,
    0x0C,
    0xEB,
    0xD8,
    0xA0,
    0x0E,
    0xED,
    0xD8,
    0xA0,
    0x10,
    0xEF,
    0xD8,
    0xA0,

    WRITE_COMMAND_8,
    0xE6,
    WRITE_BYTES,
    4,
    0x00,
    0x00,
    0x11,
    0x11,

    WRITE_COMMAND_8,
    0xE7,
    WRITE_BYTES,
    2,
    0x44,
    0x44,

    WRITE_COMMAND_8,
    0xE8,
    WRITE_BYTES,
    16,
    0x09,
    0xE8,
    0xD8,
    0xA0,
    0x0B,
    0xEA,
    0xD8,
    0xA0,
    0x0D,
    0xEC,
    0xD8,
    0xA0,
    0x0F,
    0xEE,
    0xD8,
    0xA0,

    WRITE_COMMAND_8,
    0xEB,
    WRITE_BYTES,
    7,
    0x02,
    0x00,
    0xE4,
    0xE4,
    0x88,
    0x00,
    0x40,

    WRITE_COMMAND_8,
    0xEC,
    WRITE_BYTES,
    2,
    0x3C,
    0x00,

    WRITE_COMMAND_8,
    0xED,
    WRITE_BYTES,
    17,
    0xAB,
    0x89,
    0x76,
    0x54,
    0x02,
    0xFF,
    0xFF,
    0xFF,
    0xFF,
    0xFF,
    0xFF,
    0x20,
    0x45,
    0x67,
    0x98,
    0xBA,

    // ------------------------------------------------------------------------
    // Zurück auf Seite 0x00, Pixelformat, MADCTL, Sleep Out, Display On
    // ------------------------------------------------------------------------
    WRITE_COMMAND_8,
    0xFF,
    WRITE_BYTES,
    5,
    0x77,
    0x01,
    0x00,
    0x00,
    0x00,

    // Pixelformat: 16-bit RGB565 (0x55) – wichtig für ESP32-RGB
    WRITE_COMMAND_8,
    0x3A,
    WRITE_BYTES,
    1,
    0x66,

    // Memory Access Control (BGR / Scanrichtung)
    WRITE_COMMAND_8,
    0x36,
    WRITE_BYTES,
    1,
    0x08,

    // Sleep Out
    WRITE_COMMAND_8,
    0x11,
    END_WRITE,
    DELAY,
    120,

    // Display ON
    BEGIN_WRITE,
    WRITE_COMMAND_8,
    0x29,
    END_WRITE,
    DELAY,
    20,
};